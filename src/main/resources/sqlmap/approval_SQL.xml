<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : xml파일은 여러개일 수 있음. 
이를 구별하기 위한 식별 용도로 사용 -->
<mapper namespace="kr.or.ddit.mapper.ApprovalMapper">


<!-- 결재요청 목록 -->
<!-- 결재자가 로그인한 관리자인 결재목록만 조회 -->
<select id="approvalList" resultType="approval">
	SELECT A.APPR_CD
		 , A.APPR_DT
		 , (SELECT COMD_NM FROM COMMON_DETAIL WHERE COMD_CD = A.APPR_YN ) APPR_YN
		 , A.APPR_RSN
		 , (SELECT COMD_NM FROM COMMON_DETAIL WHERE COMD_CD = A.APPR_CATE ) APPR_CATE
		 , A.PRO_NO
		 , (SELECT EP.EMP_NM FROM EMPLOYEE EP WHERE EP.EMP_NO = A.PRO_NO ) PRO_NM
		 , (SELECT EE.EMP_NM FROM EMPLOYEE EE WHERE EE.EMP_NO = A.EMP_NO ) EMP_NM
		 , A.APPR_SDT
		 , A.APPR_TAG_CD
	FROM APPROVAL A
	ORDER BY A.APPR_SDT DESC
</select>

<insert id="insertApproval" parameterType="approval"> 
	<selectKey order="BEFORE" resultType="int" keyProperty="apprCd">
		SELECT NVL(MAX(APPR_CD),0) + 1 FROM APPROVAL
	</selectKey>
		INSERT INTO APPROVAL(APPR_CD, APPR_YN, APPR_CATE, PRO_NO, APPR_SDT, APPR_TAG_CD)
		    VALUES(#{apprCd}, 'AP002', #{apprCate}, #{proNo}, SYSDATE, #{apprTagCd})
</insert>
</mapper>

